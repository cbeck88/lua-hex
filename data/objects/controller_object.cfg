{
        id: "controller_object",
	next_animation: "'normal'",
	is_human: true,
	is_strict: true,
	always_active: true,

	properties: {
		_game: { type: "class game", init: "construct('game')" },
		update_tiles: "def() ->commands
		[
			debug('Updating tiles'),
			map (existing_tiles,
				if( game_value is null, value.destroy(),
					if (value.hex_type != game_value,
						set(value.hex_type, game_value)))
				where game_value = _game.map[value.loc]
			),
			map (_game.map,
				if ([] = filter(existing_tiles,
					value.loc = k),
					[
						spawn('tile', k[0], k[1], {loc: k, hex_type: v, _controller: me}),
						debug(['Spawning a tile at: ', k]),
					]
				)
				where k = key
				where v = value
			)
		]
		where existing_tiles = filter(level.chars, value is obj tile)
",
	},

/*	lua: "
                local events = Anura.me.event_handlers
                local me = Anura.me
               
                local test_fn = function()
                        print('Hi')
                end
                 
                events.create = function()
                        print('create')
                        test_fn()

--			me.update_tiles()
                end
	",*/

	on_create: '[
		debug("on_create"),
		update_tiles()
	]'
}
